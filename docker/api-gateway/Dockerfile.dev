# Development Dockerfile with faster rebuild times
FROM rust:1.80-alpine

# Install system dependencies and tools
RUN apk add --no-cache \
    musl-dev \
    pkgconfig \
    openssl-dev \
    openssl-libs-static \
    curl

# Install cargo-watch for development
RUN cargo install cargo-watch --locked

# Create app directory
WORKDIR /app

# Set environment variables for static linking
ENV RUSTFLAGS="-C target-feature=+crt-static"

# Copy Cargo files
COPY api-gateway/Cargo.toml ./
COPY api-gateway/Cargo.loc[k] ./

# Create source directory
RUN mkdir src

# Set environment variables for development
ENV RUST_LOG=debug
ENV PORT=3000

# Expose port
EXPOSE 3000

# Development command with hot reload
CMD ["cargo", "watch", "-x", "run"]
